---
title: "Week 32 A Two-way ANOVA"
author: "Dinkar Sharma, Lazaros Gonidis"
date: "28/02/2022"
output:
  html_document: default
---

```{r setup, include=FALSE}
options(digits = 3)
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

Just like last week’s exercise, this exercise requires you to investigate a significant interaction by computing a series of simple main effects. The technique for a completely within-participants design is a little different to the one you already know, so again we will work through an example to help you learn it. Some of the packages and functions we will be using are:    

`library(haven) ### used to load SPSS .sav files, read_sav()`  
`library(tidyverse) ### for general purpose functions`   
`library(rstatix) ### used for our ANOVA, anova_test()`
`library(emmeans) ### used for emmeans() to explore simple main effects`    
`library(ggpubr) ### used for graphs such as gghistogram()`     
`library(gmodels) ### used for fit.contrast() to create contrasts`   

Let’s start by opening the dataset: **2-wayWithin-SubectsAnova.sav**, which is in the MOODLE-SP500-COMPUTING-data files for SPSS exercise folder. This is data from a cognitive experiment, in which participants had to tap with one hand while simultaneously doing a memory task, which involved remembering either words or the position of objects. So there are two IVs here: let’s call them **Hand** (left or right) and **Task** (words or positions). Start by carrying out the overall ANOVA as it is shown in the lecture slides. You should find that there is a significant interaction between the two factors, *F*(1,23) = 4.807, *MSE* = 4.460, *p* = .039. If you look at the means, or draw a graph, you will see that the effect of task is much larger in the left hand condition than it is in the right hand condition. Like the last exercise, we now need to conduct simple effects to further describe the interaction. 

NB: The method that is described below follows the advice given by Howell (1997).   Conceptually, simple main effects analyses involves breaking down the two-way interaction into a number of one-way analyses.  With a completely within-subjects design you do this in SPSS by running separate one-way analysis of variance.  For this example the simple main effects analyses that you want to do are the following.
 
(A) Simple main effect of HAND within words
(B) Simple main effect of HAND within position
(C) Simple main effect of TASK within left hand
(D) Simple main effect of TASK within right hand


Here is how to do the simple main effects analysis in R:   

We will start by running the overall analysis (‘omnibus analysis’) as we have done in previous weeks. We will open the datafile, assign it to a dataframe, declare our factor levels and labels, and acquire means. Note that we will be using the function `factor` and not `as.factor` as it allows us to quickly specify levels and labels.




```{r example, echo=TRUE, message=FALSE, warning=FALSE}
library(haven) ### used to load SPSS .sav files, read_sav()
library(tidyverse) ### for general purpose functions
library(rstatix) ### used for our ANOVA, anova_test()
library(ggpubr) ### used for graphs such as gghistogram()

df <- read_sav("2-WayWithin-SubjectsAnova.sav")

```

By observing your df dataframe it is apparent that the dataframe is in **wide** format and not **long** format. Before moving on to the main analysis we need to bring it to **long** format. Furthermore, for our repeated measures anova we need a participant id column which currently is missing. We will add one which will add the row number as participant id. We will do that by using the expression `seq.int(nrow())`


```{r example_long, echo=TRUE, message=FALSE, warning=FALSE}
## adding participant id column
df$id <- seq.int(nrow(df))

## converting our wide format to long
df_long <- df %>% 
  pivot_longer(!id, 
               names_to = c("Hand", "Task"),
               names_pattern = "(.*?)Hand(.*)",
               values_to = "Performance")
```

In the code above we used a number of arguments with the `pivot_longer` function in order to convert our **wide** structure to **long**.   

1. **!id** here we specify to our function that we will work with all our columns except the **id** column. This is because the **id** column does not contain any measurements that need restructuring, it merely provides the code for each participant.   
2. **names_to = c("Hand", "Task")** here we specify the names of our new factor columns. We will need two new factors called **

```{r example_long2, echo=TRUE, message=FALSE, warning=FALSE}
df_long$Hand <-factor(df_long$Hand,
                      levels=c("Left","Right"),
                      labels =c("Left","Right"))

df_long$Task <-factor(df_long$Task, 
                      levels=c("Words","Position"),
                      labels=c("Words","Position"))

df_long$id <- factor(df_long$id)

summary(df_long)
```

We are now ready to run our ANOVA as it is shown in the lecture slides.


```{r example_anova, echo=TRUE, message=FALSE, warning=FALSE}
result.anova <- anova_test(data = df_long, 
           dv = Performance, 
           wid = id,
           within = c(Hand, Task),
           detailed = TRUE)

result.anova


```

And we will follow-up the interaction with two separate one-way ANOVAs. One for Hand and one for Task.

```{r example_anova2, echo=TRUE, message=FALSE, warning=FALSE}

df_long %>% 
  group_by(Hand) %>%
  anova_test(dv = Performance, 
           wid = id,
           within = Task,
           detailed = TRUE)

df_long %>% 
  group_by(Task) %>%
  anova_test(dv = Performance, 
           wid = id,
           within = Hand,
           detailed = TRUE)

```

From the output above we can see that we have:    
1. Simple main effect of HAND within word is not significant, F(1, 23) = 1.926, p = 0.178.   
2. Simple main effect of HAND within position is also not significant, F(1,23) = .405, p = 0.531.    
3. Simple main effect of TASK within right hand is not significant, F(1,23) = 0.298, p = 0.590.    
4. Simple main effect of TASK within left hand is significant, F(1, 23) = 5.122, p = .033.    

## Reporting in results section   
We would report the above findings as follows: The significant interaction between hand and task was further investigated using simple main effects analysis.  This showed that there was a significant simple main effect of TASK within left hand, *F*(1,23) = 5.122, *p* = .033. This indicates that left-hand tapping was disrupted to a greater extent by memorizing words than memorizing positions. All other simple main effects were not significant (all *F*s < 2, *p* > 0.1). 


## Task 1.a: A 1 factor, two level repeated measures ANOVA.
 
	In previous exercises we have used the data file **stress.sav** which involved stress levels of patients and spouses (both male and female) being measured shortly after and three months after cancer was diagnosed. In Week 26 Example exercise, you carried out a t-test to investigate the difference between stress at time 1 (called STRESS1 in the data file) and stress at time 2 (STRESS2). Here, in task 1, this same analysis is to be generated but this time using the repeated measures ANOVA procedure. 

Q1) Report the F-value, degrees of freedom and significance level for this repeated measures One-Way ANOVA.    
Q2) Are the significance levels the same here as in Week 26? 
Q3) How does the F value in the results of this ANOVA relate to the t value in Week 26?

```{r task1a echo=TRUE, message=FALSE, warning=FALSE}

library(haven) ### used to load SPSS .sav files, read_sav()
library(tidyverse) ### for general purpose functions
library(rstatix) ### used for our ANOVA, anova_test()
library(ggpubr) ### used for graphs such as gghistogram()


df <- read_sav("stress.sav")

df$id <- seq.int(nrow(df))

df_long <- df %>% 
  pivot_longer(!id, 
               names_to = c("Hand", "Task"),
               names_pattern = "(.*?)Hand(.*)",
               values_to = "Performance")

df_long$Hand <-factor(df_long$Hand, 
                      levels=c("Left","Right"))

df_long$Task <-factor(df_long$Task, 
                      levels=c("Words","Position"))

df_long$id <- factor(df_long$id)



count1 <-df_long %>% group_by(Hand, Task) %>% 
  count(id)


result.anova <- anova_test(data = df_long, 
                                    dv = Performance, 
                                    wid = id,
                                    within = c(Hand, Task),
                                    detailed = TRUE)

```



